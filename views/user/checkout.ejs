<link rel="stylesheet" href="/styles/user/checkout.css">
<div class="container">
    <div class="checkout-header">
        <h1 class="checkout-title">CHECKOUT</h1>
        <a href="/cart" class="back-to-cart">← Back to Cart</a>
    </div>

    <div class="checkout-content">
        <!-- Left Column: Address and Payment -->
        <div class="checkout-left">
            <!-- Shipping Address Section -->
            <div class="checkout-section">
                <h2 class="section-title">Shipping Address</h2>

                <% if (userAddresses && userAddresses.length> 0) { %>
                    <div class="address-options">
                        <% userAddresses.forEach(function(address, index) { %>
                            <div class="address-option <%= address.isDefault ? 'default-address' : '' %>">
                                <input type="radio" id="address-<%= index %>" name="selectedAddress"
                                    value="<%= address._id %>" class="address-radio"
                                    aria-label="Select address <%= index + 1 %>" <%=address.isDefault ? 'checked' : ''
                                    %>>

                                <label for="address-<%= index %>" class="address-label">
                                    <div class="address-content">
                                        <div class="address-header">
                                            <span class="address-title">
                                                <%= address.type %>
                                                    <% if (address.isDefault) { %>
                                                        <span class="default-badge">Default</span>
                                                        <% } %>
                                            </span>
                                            <span class="address-phone">
                                                <%= address.phone %>
                                            </span>
                                        </div>
                                        <div class="address-details">
                                            <%= address.formattedAddress || (address.fullAddress + ', ' + address.city
                                                + ', ' + address.state + ' - ' + address.pincode) %>
                                        </div>
                                    </div>
                                </label>
                            </div>
                            <% }); %>
                    </div>
                    <% if(userAddresses.length < 4) { %>
                        <div class="add-new-address-section">
                            <button type="button" class="add-address-link" onclick="openAddressModal()">+ Add New
                                Address</button>
                        </div>
                        <% } %>
                            <% } else { %>
                                <div class="no-addresses">
                                    <div class="no-addresses-content">
                                        <p class="no-addresses-text">You don't have any saved addresses yet.</p>
                                        <p class="no-addresses-subtext">Add a shipping address to complete your order.
                                        </p>
                                        <div class="add-new-address-section">
                                            <button type="button" class="add-address-link"
                                                onclick="openAddressModal()">+ Add
                                                New Address</button>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
            </div>

            <!-- Payment Method -->
            <div class="checkout-section">
                <h2 class="section-title">Payment Method</h2>
                <div class="payment-methods">
                    <div class="payment-option">
                        <input type="radio" id="wallet" name="paymentMethod" value="WALLET" class="payment-radio">
                        <label for="wallet" class="payment-label">
                            <div class="payment-content">
                                <span class="payment-title">Wallet</span>
                                <span class="payment-desc">Pay easily using your wallet balance</span>
                            </div>
                        </label>
                    </div>

                    <div class="payment-option">
                        <input type="radio" id="razorpay" name="paymentMethod" value="RAZORPAY" class="payment-radio">
                        <label for="razorpay" class="payment-label">
                            <div class="payment-content">
                                <span class="payment-title">Razorpay</span>
                                <span class="payment-desc">Pay securely using Razorpay</span>
                            </div>
                        </label>
                    </div>

                    <div class="payment-option">
                        <input type="radio" id="cod" name="paymentMethod" value="COD" class="payment-radio" checked>
                        <label for="cod" class="payment-label">
                            <div class="payment-content">
                                <span class="payment-title">Cash on Delivery</span>
                                <span class="payment-desc">Pay when you receive your order</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Order Items and Summary -->
        <div class="checkout-right">
            <!-- Cart Items Section -->
            <div class="checkout-section">
                <h2 class="section-title">Order Items</h2>
                <div class="order-items">
                    <% if (cart && cart.items.length> 0) { %>
                        <% cart.items.forEach(function(item) { %>
                            <div class="order-item">
                                <img src="<%= item.image %>" alt="<%= item.productName %>" class="item-image">
                                <div class="item-details">
                                    <h3 class="item-name">
                                        <%= item.productName %>
                                    </h3>
                                    <% if (item.selectedColor) { %>
                                        <div class="item-color">Colour: <%= item.selectedColor %>
                                        </div>
                                        <% } %>
                                            <div class="item-price">
                                                <% if (item.price> item.discountedPrice) { %>
                                                    <span class="original-price">₹<%= item.price.toLocaleString() %>
                                                    </span>
                                                    <% } %>
                                                        <span class="discounted-price">₹<%= item.discountedPrice ?
                                                                item.discountedPrice.toLocaleString() : "0" %></span>
                                            </div>
                                </div>
                                <div class="item-quantity">
                                    <span class="quantity-label">Qty: <%= item.quantity %></span>
                                </div>
                                <div class="item-total">
                                    ₹<%= (item.discountedPrice * item.quantity).toLocaleString() %>
                                </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <div class="empty-items">
                                        <p>No items in cart</p>
                                        <a href="/sale" class="continue-shopping-link">Continue Shopping</a>
                                    </div>
                                    <% } %>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="checkout-section">
                <h2 class="section-title">Order Summary</h2>
                <div class="order-summary">
                    <div class="summary-row">
                        <span class="summary-label">Subtotal</span>
                        <span class="summary-value">₹<%= subtotal.toLocaleString() %></span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Tax (GST 18%)</span>
                        <span class="summary-value">₹<%= tax.toLocaleString() %></span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Shipping</span>
                        <span class="summary-value shipping-free">FREE</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-row total-row">
                        <span class="summary-label">Total</span>
                        <span class="summary-value total-value">₹<%= total.toLocaleString() %></span>
                    </div>
                </div>
            </div>

            <!-- Place Order Button -->
            <div class="checkout-section">
                <button type="button" class="place-order-btn" onclick="placeOrder()">
                    Place Order - ₹<%= total.toLocaleString() %>
                </button>
                <p class="order-note">
                    By placing your order, you agree to our terms and conditions.
                    You will receive an order confirmation email shortly.
                </p>
            </div>
        </div>
    </div>

    <!-- Address Modal -->
    <div id="addressModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Address</h2>
                <button class="modal-close" onclick="closeAddressModal()">×</button>
            </div>

            <!-- Address Form -->
            <form id="addressForm">
                <div class="form-section">
                    <h2 class="section-title">Personal Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="name">Full name</label>
                            <input type="text" id="name" name="fullName" class="form-input" placeholder="John">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="email">Email</label>
                            <input type="email" id="email" name="email" class="form-input"
                                placeholder="example@gmail.com">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-group full-width">
                        <label class="form-label" for="addressLine1">Address</label>
                        <textarea id="addressLine1" name="fullAddress" class="form-input textarea-input"
                            placeholder="House Name, House Number, Locality"></textarea>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="district">District</label>
                            <input type="text" id="district" name="district" class="form-input"
                                placeholder="eg: Ernakulam">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="state">State</label>
                            <input type="text" id="state" name="state" class="form-input" placeholder="eg: Kerala">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="city">City</label>
                            <input type="text" id="city" name="city" class="form-input" placeholder="eg: Kochi">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="pincode">Pin Code</label>
                            <input type="text" id="pincode" name="pincode" class="form-input" placeholder="eg: 689230"
                                pattern="[0-9]{6}">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Address Type</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="type" value="Home" checked>
                                    <span class="radio-text">Home</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="type" value="Work">
                                    <span class="radio-text">Work</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="type" value="Other">
                                    <span class="radio-text">Other</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="phoneNumber">Phone Number</label>
                            <input type="tel" id="phoneNumber" name="phone" class="form-input"
                                placeholder="eg: +91 6892303458" pattern="[+]?[0-9\s-]+">
                        </div>
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="cancel-btn" onclick="closeAddressModal()">Cancel</button>
                    <button type="submit" class="submit-btn" id="submitBtn">Add Address</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    function openAddressModal() {
        document.getElementById('addressModal').style.display = 'flex';
    }

    function closeAddressModal() {
        document.getElementById('addressModal').style.display = 'none';
    }

    // Handle form submission via AJAX
    document.getElementById('addressForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);
        const addressData = Object.fromEntries(formData.entries());

        try {
            const response = await axios.post('/profile/address/add', addressData);

            if (response.data.success) {
                location.reload();
            }
        } catch (error) {
            closeAddressModal();
            Swal.fire({
                icon: 'error',
                title: 'Failed to add address',
                text: error.response?.data?.message || 'Please try again.'
            });
        }
    });

    async function placeOrder() {
        const checkPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
        const checkSelectedAddress = document.querySelector('input[name="selectedAddress"]:checked');

        if (!checkPaymentMethod) {
            Swal.fire({
                icon: 'error',
                title: 'Payment Method Required',
                text: 'Please select a payment method.'
            });
            return;
        }

        if (!checkSelectedAddress) {
            Swal.fire({
                icon: 'error',
                title: 'Address Required',
                text: 'Please select a shipping address before placing your order.',
                confirmButtonText: 'Ok'
            });
            return;
        }


        const orderData = {
            paymentMethod: checkPaymentMethod.value,
            address: checkSelectedAddress.value,
        };

        try {
            // Show loading
            Swal.fire({
                title: 'Processing Order...',
                text: 'Please wait while we process your order.',
                allowOutsideClick: false,
                showConfirmButton: false,
                willOpen: () => Swal.showLoading()
            });

            await new Promise(resolve => setTimeout(resolve, 2000));

            const response = await axios.post('/checkout/place-order', orderData);

            Swal.close(); // close loading

            // Razorpay Payment
            if (response.data.razorpayOrderId) {
                const options = {
                    key: "<%= process.env.RAZORPAY_KEY_ID %>",
                    amount: response.data.totalAmount * 100, // must be in paise
                    currency: response.data.currency,
                    order_id: response.data.razorpayOrderId,
                    handler: async function (razorpayResponse) {
                        try {
                            const verifyRes = await axios.post("/checkout/place-order/razorpay-verify", razorpayResponse);
                            if (verifyRes.data.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: '<i class="fas fa-check-circle"></i> Order Placed Successfully',
                                    html: `
                        <div style="text-align: center; padding: 20px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
                                <h3 style="margin: 0 0 15px 0; font-size: 18px; color: #212529; font-weight: 500;">
                                    <i class="fas fa-thumbs-up"></i> Thank you for your purchase
                                </h3>
                                <div style="background: #ffffff; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; margin-top: 15px;">
                                    <p style="margin: 0; font-size: 16px; color: #495057;">
                                        <strong><i class="fas fa-receipt"></i> Order ID:</strong>
                                        <br>
                                        <span style="font-family: 'Courier New', monospace; background: #f8f9fa; padding: 8px 12px; border-radius: 4px; color: #212529; border: 1px solid #e9ecef; display: inline-block; margin-top: 8px; font-size: 15px;">
                                            ${response.data.orderId}
                                        </span>
                                    </p>
                                </div>
                                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                                    <p style="margin: 0; font-size: 14px; color: #6c757d;">
                                        <i class="fas fa-truck"></i> Your order is being processed and will be shipped soon
                                    </p>
                                </div>
                            </div>
                        </div>
                    `,
                                    showCancelButton: true,
                                    confirmButtonText: '<i class="fas fa-list-alt"></i> View Orders',
                                    cancelButtonText: '<i class="fas fa-shopping-bag"></i> Continue Shopping',
                                    confirmButtonColor: '#212529',
                                    cancelButtonColor: '#6c757d',
                                    buttonsStyling: true,
                                    background: '#ffffff',
                                    backdrop: 'rgba(0,0,0,0.5)',
                                    allowOutsideClick: false,
                                    allowEscapeKey: true
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        Swal.fire({
                                            title: '<i class="fas fa-spinner fa-spin"></i> Loading...',
                                            text: 'Redirecting to your orders',
                                            allowOutsideClick: false,
                                            showConfirmButton: false,
                                            background: '#ffffff',
                                            color: '#212529',
                                            willOpen: () => {
                                                Swal.showLoading();
                                            }
                                        });
                                        window.location.href = '/profile/orders';
                                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                                        window.location.href = '/sale';
                                    }
                                });
                            }
                        } catch (err) {
                            console.error("Verify error:", err);
                            Swal.fire({
                                icon: 'error',
                                title: '<i class="fas fa-times-circle"></i> Payment Failed',
                                html: `
        <div style="text-align: center; padding: 20px;">
            <div style="background: #fff5f5; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #f8d7da;">
                <h3 style="margin: 0 0 15px 0; font-size: 18px; color: #721c24; font-weight: 500;">
                    <i class="fas fa-exclamation-triangle"></i> Oops! Something went wrong
                </h3>
                <div style="background: #ffffff; padding: 15px; border-radius: 6px; border: 1px solid #f5c6cb; margin-top: 15px;">
                    <p style="margin: 0; font-size: 16px; color: #721c24;">
                        <strong><i class="fas fa-credit-card"></i> Payment Status:</strong>
                        <br>
                        <span style="font-family: 'Courier New', monospace; background: #fff5f5; padding: 8px 12px; border-radius: 4px; color: #721c24; border: 1px solid #f5c6cb; display: inline-block; margin-top: 8px; font-size: 15px;">
                            Transaction Failed
                        </span>
                    </p>
                </div>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f8d7da;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <i class="fas fa-info-circle"></i> Please try again or use a different payment method
                    </p>
                </div>
            </div>
        </div>
    `,
                                showCancelButton: true,
                                confirmButtonText: '<i class="fas fa-redo"></i> Try Again',
                                cancelButtonText: '<i class="fas fa-home"></i> Back to Home',
                                confirmButtonColor: '#dc3545',
                                cancelButtonColor: '#6c757d',
                                buttonsStyling: true,
                                background: '#ffffff',
                                backdrop: 'rgba(0,0,0,0.5)',
                                allowOutsideClick: false,
                                allowEscapeKey: true
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    Swal.fire({
                                        title: '<i class="fas fa-spinner fa-spin"></i> Retrying...',
                                        text: 'Please wait while we redirect you',
                                        allowOutsideClick: false,
                                        showConfirmButton: false,
                                        background: '#ffffff',
                                        color: '#212529',
                                        willOpen: () => {
                                            Swal.showLoading();
                                        }
                                    });
                                    // Redirect to retry payment page
                                    window.location.href = '/checkout/';
                                } else if (result.dismiss === Swal.DismissReason.cancel) {
                                    window.location.href = '/home';
                                }
                            });
                        }
                    },
                    modal: {
                        ondismiss: function () {
                            Swal.fire({
                                icon: 'error',
                                title: '<i class="fas fa-times-circle"></i> Payment Failed',
                                html: `
        <div style="text-align: center; padding: 20px;">
            <div style="background: #fff5f5; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #f8d7da;">
                <h3 style="margin: 0 0 15px 0; font-size: 18px; color: #721c24; font-weight: 500;">
                    <i class="fas fa-exclamation-triangle"></i> Oops! Something went wrong
                </h3>
                <div style="background: #ffffff; padding: 15px; border-radius: 6px; border: 1px solid #f5c6cb; margin-top: 15px;">
                    <p style="margin: 0; font-size: 16px; color: #721c24;">
                        <strong><i class="fas fa-credit-card"></i> Payment Status:</strong>
                        <br>
                        <span style="font-family: 'Courier New', monospace; background: #fff5f5; padding: 8px 12px; border-radius: 4px; color: #721c24; border: 1px solid #f5c6cb; display: inline-block; margin-top: 8px; font-size: 15px;">
                            Transaction Failed
                        </span>
                    </p>
                </div>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f8d7da;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <i class="fas fa-info-circle"></i> Please try again or use a different payment method
                    </p>
                </div>
            </div>
        </div>
    `,
                                showCancelButton: true,
                                confirmButtonText: '<i class="fas fa-redo"></i> Try Again',
                                cancelButtonText: '<i class="fas fa-home"></i> Back to Home',
                                confirmButtonColor: '#dc3545',
                                cancelButtonColor: '#6c757d',
                                buttonsStyling: true,
                                background: '#ffffff',
                                backdrop: 'rgba(0,0,0,0.5)',
                                allowOutsideClick: false,
                                allowEscapeKey: true
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    Swal.fire({
                                        title: '<i class="fas fa-spinner fa-spin"></i> Retrying...',
                                        text: 'Please wait while we redirect you',
                                        allowOutsideClick: false,
                                        showConfirmButton: false,
                                        background: '#ffffff',
                                        color: '#212529',
                                        willOpen: () => {
                                            Swal.showLoading();
                                        }
                                    });
                                    // Redirect to retry payment page
                                    window.location.href = '/checkout/';
                                } else if (result.dismiss === Swal.DismissReason.cancel) {
                                    window.location.href = '/';
                                }
                            });

                        }
                    }
                };

                const rzp = new Razorpay(options);

                // ✅ Handle payment failure
                rzp.on("payment.failed", function (response) {
                    console.error("Payment failed", response.error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Payment Failed',
                        text: response.error.description || 'Your payment could not be processed.'
                    });
                });

                rzp.open();
                return; // stop further execution
            }

            // COD (Cash on Delivery)
            if (response.data.success) {
                Swal.fire({
                    icon: 'success',
                    title: '<i class="fas fa-check-circle"></i> Order Placed Successfully',
                    html: `
                        <div style="text-align: center; padding: 20px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #e9ecef;">
                                <h3 style="margin: 0 0 15px 0; font-size: 18px; color: #212529; font-weight: 500;">
                                    <i class="fas fa-thumbs-up"></i> Thank you for your purchase
                                </h3>
                                <div style="background: #ffffff; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6; margin-top: 15px;">
                                    <p style="margin: 0; font-size: 16px; color: #495057;">
                                        <strong><i class="fas fa-receipt"></i> Order ID:</strong>
                                        <br>
                                        <span style="font-family: 'Courier New', monospace; background: #f8f9fa; padding: 8px 12px; border-radius: 4px; color: #212529; border: 1px solid #e9ecef; display: inline-block; margin-top: 8px; font-size: 15px;">
                                            ${response.data.orderId}
                                        </span>
                                    </p>
                                </div>
                                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                                    <p style="margin: 0; font-size: 14px; color: #6c757d;">
                                        <i class="fas fa-truck"></i> Your order is being processed and will be shipped soon
                                    </p>
                                </div>
                            </div>
                        </div>
                    `,
                    showCancelButton: true,
                    confirmButtonText: '<i class="fas fa-list-alt"></i> View Orders',
                    cancelButtonText: '<i class="fas fa-shopping-bag"></i> Continue Shopping',
                    confirmButtonColor: '#212529',
                    cancelButtonColor: '#6c757d',
                    buttonsStyling: true,
                    background: '#ffffff',
                    backdrop: 'rgba(0,0,0,0.5)',
                    allowOutsideClick: false,
                    allowEscapeKey: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: '<i class="fas fa-spinner fa-spin"></i> Loading...',
                            text: 'Redirecting to your orders',
                            allowOutsideClick: false,
                            showConfirmButton: false,
                            background: '#ffffff',
                            color: '#212529',
                            willOpen: () => {
                                Swal.showLoading();
                            }
                        });
                        window.location.href = '/profile/orders';
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        window.location.href = '/sale';
                    }
                });
            }
        } catch (error) {
            console.error('Error placing order:', error);
            Swal.fire({
                icon: 'error',
                title: '<i class="fas fa-times-circle"></i> Payment Failed',
                html: `
        <div style="text-align: center; padding: 20px;">
            <div style="background: #fff5f5; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #f8d7da;">
                <h3 style="margin: 0 0 15px 0; font-size: 18px; color: #721c24; font-weight: 500;">
                    <i class="fas fa-exclamation-triangle"></i> Oops! Something went wrong
                </h3>
                <div style="background: #ffffff; padding: 15px; border-radius: 6px; border: 1px solid #f5c6cb; margin-top: 15px;">
                    <p style="margin: 0; font-size: 16px; color: #721c24;">
                        <strong><i class="fas fa-credit-card"></i> Payment Status:</strong>
                        <br>
                        <span style="font-family: 'Courier New', monospace; background: #fff5f5; padding: 8px 12px; border-radius: 4px; color: #721c24; border: 1px solid #f5c6cb; display: inline-block; margin-top: 8px; font-size: 15px;">
                            Transaction Failed
                        </span>
                    </p>
                </div>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #f8d7da;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <i class="fas fa-info-circle"></i> Please try again or use a different payment method
                    </p>
                </div>
            </div>
        </div>
    `,
                showCancelButton: true,
                confirmButtonText: '<i class="fas fa-redo"></i> Try Again',
                cancelButtonText: '<i class="fas fa-home"></i> Back to Home',
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                buttonsStyling: true,
                background: '#ffffff',
                backdrop: 'rgba(0,0,0,0.5)',
                allowOutsideClick: false,
                allowEscapeKey: true
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: '<i class="fas fa-spinner fa-spin"></i> Retrying...',
                        text: 'Please wait while we redirect you',
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        background: '#ffffff',
                        color: '#212529',
                        willOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    // Redirect to retry payment page
                    window.location.href = '/checkout/';
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    window.location.href = '/';
                }
            });

        }
    }
</script>