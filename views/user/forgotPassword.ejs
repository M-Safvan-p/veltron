<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forgot Password</title>

  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../styles/user/forgotPassword.css">

</head>

<body>
  <div class="forgot-container">
    <h2>Forgot Password ?</h2>

    <form id="forgotForm">
      <div class="mb-3 text-start">
        <label for="email" class="form-label">Enter your registered email</label>
        <input type="text" class="form-control" id="email" name="email" placeholder="helloworld@gmail.com" />
      </div>

      <button type="submit" class="btn btn-primary" id="verifyBtn">Verify Email</button>
    </form>
  </div>

  <script>
    const form = document.getElementById("forgotForm");
    const verifyBtn = document.getElementById("verifyBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const email = document.getElementById("email").value;

      if (!emailRegex.test(email)) {
        Swal.fire({
          icon: "warning",
          title: "Invalid Email",
          text: "Please enter a valid email address (e.g. hello@example.com)",
          confirmButtonText: "OK"
        });
        return;
      }

      verifyBtn.disabled = true;
      verifyBtn.textContent = "Verifying...";

      try {
        const response = await axios.post("/forgotPassword", { email });

        // show success notification
        Swal.fire({
          icon: "success",
          title: "OTP Sent!",
          text: response.data.message || "Check your email for OTP.",
          confirmButtonText: "OK",
          customClass: { confirmButton: 'swal-confirm-black' }
        }).then(() => {
          window.location.href = "/forgotPassword/verify";
        });

      } catch (error) {
        Swal.fire({
          icon: "error",
          title: "Oops...",
          text: error.response?.data?.message || "Failed to send OTP. Try again.",
          confirmButtonText: "Retry",
          customClass: { confirmButton: 'swal-confirm-black' }
        });
      } finally {
        // re-enable button
        verifyBtn.disabled = false;
        verifyBtn.textContent = "Verify Email";
      }
    });
  </script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>