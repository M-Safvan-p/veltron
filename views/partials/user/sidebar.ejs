<!-- Profile Sidebar Partial - Save as: views/partials/_sidebar.ejs -->
<link rel="stylesheet" href="../../../styles/partials/user/sidebar.css">
<!-- Sidebar (no overlay since it's always visible) -->
<div class="profile-sidebar">
    <div class="profile-sidebar-content">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-avatar">
                <% if (user.profileImage) { %>
                    <img src="<%= user.profileImage %>" alt="<%= user.fullName %>" class="profile-image">
                    <% } else { %>
                        <i class="fas fa-user"></i>
                        <% } %>
            </div>
            <div class="profile-name">
                <%= user.fullName %>
            </div>
        </div>

        <!-- Profile Menu -->
        <ul class="profile-menu">
            <li class="menu-item">
                <a href="/profile"
                    class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'profile') ? 'active' : '' %>">
                    <i class="fas fa-user menu-icon"></i>
                    <span class="menu-text">My Profile</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/profile/address"
                    class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'address') ? 'active' : '' %>">
                    <i class="fas fa-map-marker-alt menu-icon"></i>
                    <span class="menu-text">My Address</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/profile/orders"
                    class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'orders') ? 'active' : '' %>">
                    <i class="fas fa-shopping-bag menu-icon"></i>
                    <span class="menu-text">My Order</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/profile/wishlist"
                    class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'wishlist') ? 'active' : '' %>">
                    <i class="fas fa-heart menu-icon"></i>
                    <span class="menu-text">My Wishlist</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/profile/wallet"
                    class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'wallet') ? 'active' : '' %>">
                    <i class="fas fa-wallet menu-icon"></i>
                    <span class="menu-text">My Wallet</span>
                </a>
            </li>
            <!-- <li class="menu-item">
                <a href="/profile/coupons"
                    class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'coupons') ? 'active' : '' %>">
                    <i class="fas fa-ticket-alt menu-icon"></i>
                    <span class="menu-text">My Coupon</span>
                </a>
            </li> -->
            <% if (!user.googleId) { %>
                <li class="menu-item">
                    <a href="/profile/change-password"
                        class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'change-password') ? 'active' : '' %>">
                        <i class="fas fa-lock menu-icon"></i>
                        <span class="menu-text">Change Password</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="/profile/change-email"
                        class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'change-email') ? 'active' : '' %>">
                        <i class="fas fa-envelope menu-icon"></i>
                        <span class="menu-text">Change Email</span>
                    </a>
                </li>
                <% } %>
                    <li class="menu-item">
                        <a href="/profile/referral"
                            class="menu-link <%= (typeof currentPage !== 'undefined' && currentPage === 'referral') ? 'active' : '' %>">
                            <i class="fas fa-users menu-icon"></i>
                            <span class="menu-text">Referral Code</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="/logout" class="menu-link logout-link" onclick="handleLogout(event)">
                            <i class="fas fa-sign-out-alt menu-icon"></i>
                            <span class="menu-text">Log Out</span>
                        </a>
                    </li>
        </ul>
    </div>
</div>
<script>
async function handleLogout(event) {
    event.preventDefault();

    Swal.fire({
        title: "Are you sure?",
        text: "You will be logged out of your account.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes, log out",
        cancelButtonText: "Cancel"
    }).then(async (result) => {
        if (result.isConfirmed) {
            try {
                const response = await axios.post('/logout');

                if (response.data.success) {
                    Swal.fire({
                        title: "Logged Out",
                        text: "You have been logged out successfully.",
                        icon: "success",
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.replace("/") // redirect to login or homepage
                    });
                } 
            } catch (error) {
                console.error("Logout failed:", error);
                const errMsg = error.response?.data?.message || "Something went wrong. Please try again.";
                Swal.fire("Error", errMsg, "error");
            }
        }
    });
}
</script>